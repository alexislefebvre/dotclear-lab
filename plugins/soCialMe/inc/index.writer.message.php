<?php
# -- BEGIN LICENSE BLOCK ----------------------------------
# This file is part of soCialMe, a plugin for Dotclear 2.
# 
# Copyright (c) 2009-2011 JC Denis and contributors
# jcdenis@gdwd.com
# 
# Licensed under the GPL version 2.0 license.
# A copy of this license is available in LICENSE file or at
# http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
# -- END LICENSE BLOCK ------------------------------------
if (!defined('DC_CONTEXT_ADMIN')){return;}# Services featuresforeach($page['class']->things() as $thing => $title){	$things[$thing] = __($title);	$usable[$thing] = $page['class']->can($thing.'Content');}# Send messageif ($request_act == 'send'){	try	{		if (!empty($_POST['s_message_text']) && !empty($_POST['s_message_services']))		{			foreach($_POST['s_message_services'] as $service => $plop)			{				$page['class']->play($service,'Message','Content',$_POST['s_message_text']);			}		}				if (!empty($_POST['s_link_text']) && !empty($_POST['s_link_services']))		{			foreach($_POST['s_link_services'] as $service => $plop)			{				$page['class']->play($service,'Link','Content',$_POST['s_link_text']);			}		}				http::redirect(soCialMeUtils::link(0,$request_page,$request_part,'','&section='.$request_section));	}	catch (Exception $e)	{		$core->error->add($e->getMessage());	}}# Displayecho soCialMeUtils::top($page,dcPage::jsLoad('index.php?pf=soCialMe/js/message.js')).'<p>'.__('Send message through your configured services.').'</p>'.'<form id="message-form" method="post" action="'.soCialMeUtils::link(1,$request_page).'">';# Short message formif (!empty($usable['Message'])){	echo 	'<fieldset id="message-message"><legend>'. __('Send simple short message').'</legend>'.	'<div class="two-cols"><div class="col">'.	'<p><label class="classic">'.__('Message:').'<br />'.	form::field(array('s_message_text'),50,255,'').	'</label></p>'.	'</div><div class="col">'.	'<p>'.__('Select services to post on:').'</p><ul>';	foreach($usable['Message'] as $service_id)	{		$service = $page['class']->services($service_id);				echo 		'<li><label class="classic" title="'.$service->name.'">'.		form::checkbox(array('s_message_services['.$service_id.']'),'1','').		($service->icon ? '<img src="'.$service->icon.'" alt="'.$service->name.'" /> ' : '').		$service->name.'</label></li>';	}	echo 	'</ul>'.	'</div></div>'.	'</fieldset>';}# Link formif (!empty($usable['Link'])){	echo 	'<fieldset id="message-link"><legend>'. __('Send simple link').'</legend>'.	'<div class="two-cols"><div class="col">'.	'<p><label class="classic">'.__('URL:').'<br />'.	form::field(array('s_link_text'),50,255,'').	'</label></p>'.	'</div><div class="col">'.	'<p>'.__('Select services to post on:').'</p><ul>';	foreach($usable['Link'] as $service_id)	{		$service = $page['class']->services($service_id);				echo 		'<li><label class="classic" title="'.$service->name.'">'.		form::checkbox(array('s_link_services['.$service_id.']'),'1','').		($service->icon ? '<img src="'.$service->icon.'" alt="'.$service->name.'" /> ' : '').		$service->name.'</label></li>';	}	echo 	'</ul>'.	'</div></div>'.	'</fieldset>';}echo '<div class="clear">'.'<p><input type="submit" name="message" value="'.__('Send').'" />'.$core->formNonce().form::hidden(array('p'),'soCialMe').form::hidden(array('page'),$request_page).form::hidden(array('part'),$request_part).form::hidden(array('section'),$request_section).form::hidden(array('act'),'send').'</p></div>'.'</form>';?>